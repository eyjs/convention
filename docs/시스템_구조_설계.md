# 행사 관리 시스템 구조 설계

## 핵심 개념

### 1. 회원(User) vs 행사 참석자(Guest)

```
User (회원)
  └─ 1:N ─> Guest (행사 참석자)
```

#### User (회원)
- **정의**: 시스템에 회원가입한 사용자
- **특징**: 
  - LoginId, Password로 로그인 가능
  - 여러 행사에 참석 가능 (1명의 회원 → N개 행사 참석)
  - Role: Admin, Guest 등

#### Guest (행사 참석자)
- **정의**: 특정 행사에 참석하는 사람
- **두 가지 유형**:
  1. **회원 참석자** (`IsRegisteredUser = true`)
     - User 계정과 연결됨 (`UserId` 외래키)
     - LoginId/Password로 로그인 가능
     - 예: 기존 회원이 새 행사에 참여
  
  2. **비회원 참석자** (`IsRegisteredUser = false`)
     - User 계정 없음
     - AccessToken으로만 접근 가능
     - 예: 동반자, 게스트 등

### 2. 참석자 생성 프로세스 (2024.10 기준 변경)

#### 기존 방식 (비회원)
```
1. Guest 생성 (IsRegisteredUser = false)
2. 필요시 관리자가 "비회원→회원 전환" 수동 실행
3. User 생성 및 연결
```

#### 현재 방식 (자동 회원 생성)
```
1. Guest 생성 요청
2. Guest 레코드 생성
3. User 계정 자동 생성
   - LoginId: AccessToken 사용
   - Password: 수기 입력 > 주민번호 앞6자리 > "123456"
4. Guest.UserId 연결 (IsRegisteredUser = true)
```

**변경 이유**: 
- 모든 참석자가 즉시 로그인 가능하도록 개선
- 비회원 전환 과정 불필요

### 3. 데이터 구조

```
Convention (행사)
  │
  ├─ 1:N ─> Guest (참석자)
  │          │
  │          ├─ UserId ─> User (회원)
  │          ├─ AccessToken (비회원 접근용)
  │          ├─ 1:N ─> GuestAttribute (속성)
  │          └─ N:M ─> ScheduleTemplate (일정 배정)
  │
  └─ 1:N ─> ScheduleTemplate (일정 템플릿/코스)
              │
              └─ 1:N ─> ScheduleItem (일정 항목)
```

### 4. 접근 방식

#### 회원 참석자
```
/login
  → LoginId/Password 입력
  → JWT 토큰 발급
  → 행사 목록 접근
```

#### 비회원 참석자 (동반자/게스트)
```
/guest/{conventionId}/{accessToken}
  → AccessToken으로 즉시 접근
  → 해당 행사만 열람 가능
```

## 비밀번호 설정 우선순위

참석자 생성 시:
1. **수기 입력 비밀번호** (관리자가 직접 입력)
2. **주민등록번호 앞 6자리** (주민번호 입력되어 있을 경우)
3. **기본값 "123456"** (위 두 가지 모두 없을 경우)

## 예시 시나리오

### 시나리오 1: 회원이 여러 행사에 참여
```
User: hong@example.com (회원)
  ├─ Guest1 → Convention1 (2024 봄 워크숍)
  ├─ Guest2 → Convention2 (2024 하계 연수)
  └─ Guest3 → Convention3 (2024 송년회)
```

### 시나리오 2: 행사에 동반자 초대
```
Convention: "2024 이탈리아 투어"
  ├─ Guest: 김철수 (회원, UserId = 5)
  │   └─ 일정: A코스
  │
  └─ Guest: 김영희 (동반자, UserId = 6, AccessToken으로 초대)
      └─ 일정: A코스
```

## 주요 기능

### 관리자
- 행사 생성/수정
- 참석자 등록 (회원/비회원 모두 자동 User 생성)
- 일정 코스 생성
- 일정 항목 추가 (수기 or 복사)
- 참석자별 일정 배정
- 엑셀 일괄 업로드

### 참석자
- 본인 일정 조회
- 일정별 상세 정보 확인
- LLM 챗봇 (행사 정보 질의응답)

## 개선 내역 (2024.10)

1. ✅ 참석자 추가 시 User 자동 생성
2. ✅ 비밀번호 우선순위 설정
3. ✅ 일정 복사 기능 (템플릿→템플릿, 참석자→참석자)
4. ✅ 일정 날짜/시간 오름차순 정렬
5. ✅ 모바일 모달 바깥 터치 닫기
6. ✅ 모바일 UI 반응형 개선
7. ✅ 행사 상세→목록 뒤로가기 버튼
